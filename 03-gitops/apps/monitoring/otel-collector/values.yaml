nameOverride: otel-collector
fullnameOverride: otel-collector
mode: deployment

config:
  receivers:
    otlp:
      protocols:
        grpc: {}
        http: {}
  processors:
    batch: { }
    k8sattributes:
      extract:
        metadata:
          - k8s.namespace.name
          - k8s.deployment.name
          - k8s.statefulset.name
          - k8s.daemonset.name
          - k8s.cronjob.name
          - k8s.job.name
          - k8s.node.name
          - k8s.pod.name
          - k8s.pod.uid
          - k8s.pod.start_time
      passthrough: false
      pod_association:
        - sources:
            - from: resource_attribute
              name: k8s.pod.ip
        - sources:
            - from: resource_attribute
              name: k8s.pod.uid
        - sources:
            - from: connection
    memory_limiter:
      check_interval: 5s
      limit_percentage: 80
      spike_limit_percentage: 25
    resource:
      attributes:
        - action: insert
          from_attribute: k8s.pod.uid
          key: service.instance.id
    transform:
      error_mode: ignore
      trace_statements:
        - context: span
          statements:
            - replace_pattern(name, "\\?.*", "")
            - replace_match(name, "GET /api/products/*", "GET /api/products/{productId}")
  exporters:
    logging: {}
    otlp:
      endpoint: jaeger-collector.monitoring:4317
      tls:
        insecure: true
    otlphttp/prometheus:
      endpoint: http://prometheus.monitoring:9090/api/v1/otlp
      tls:
        insecure: true
  service:
    pipelines:
      traces:
        receivers: [otlp]
        processors: [batch]
        exporters: [otlp]
      metrics:
        receivers: [otlp]
        processors: []
        exporters: [logging]
      logs:
        receivers: [otlp]
        processors: []
        exporters: [logging]